
const zkpSendS = require('./miner.js').zkpSendS

let yArr = [
    4372975516414768656599949n,
    782020033697565984450581n,
    4391140013247493675978947n,
    1552672725310496821631126n,
    7102296133217977221280952n,
    7168208489319713136408769n,
    1051363914149377854653744n,
    1146675187781497330767559n,
    7459363406161653003098377n,
    4776567801486156769681093n,
    4670913227268998507968455n,
    2974773820573227880833223n,
    5194246632243742033406004n,
    4627464387525305295843281n,
    3877168429814361907440130n,
    2759822052731677792863384n,
    3051636867362551579311443n,
    8242259051577851160261552n,
    8660425110675956498414198n,
    6482814975379690034398151n,
    1121721747122873484679437n,
    4764853495290947381108n,
    5025607762554560674852916n,
    4777720454986490255636139n,
    1185663279421924536285477n,
    854008707333322454976878n,
    2583070135798114874248455n,
    3000017733932205962458592n,
    7399421218331203993285207n,
    5628335908828639818318367n,
    6614016041666667238354043n,
    4545695437745284036729547n,
    6560313649376920218053306n,
    686731073887754429997882n,
    6798380871340042407908257n,
    8322617041748068057426676n,
    8136685546728627260028084n,
    139429211928856621077869n,
    3580363950667800359027829n,
    1640529873418957477120331n,
    245320190277891715764914n,
    8581737021799051604785046n,
    4497825252888302555545525n,
    1896639607219937133232124n,
    4189150862021630519548239n,
    33516745124485307023584n,
    1309586939408021969094910n,
    6613568360771806943273497n,
    2457517985885919142162066n,
    4271238929875333653935126n,
    4710307532381063588773423n,
    4611282764587609674297239n,
    5565521857839725612897452n,
    8032860333614937550737020n,
    5766618166521338682699668n,
    3037936424376472759003513n,
    6890805457659333245662489n,
    1414650875095962159193051n,
    7266737321307452943844770n,
    5822640553893368207355888n,
    5536284105396168305997787n,
    6085253290945504294654403n,
    8260650939225110454839155n,
    6276062844844346206165173n,
    4686720360063407436435637n,
    1599676609955327138991944n,
    6003721871528522296375175n,
    3133729521114844581215127n,
    7077708884687489198052627n,
    3660356039855178615911949n,
    8679536012973056836341507n,
    1913978262523549201975884n,
    5734974875687307349178226n,
    6025022815354275848967414n,
    2567257926333502050352665n,
    7322978130401870228412336n,
    6498971596204855698837494n,
    4868412906564042553837301n,
    5862389532076314196909782n,
    3669053878486693263027715n,
    1125111173828025448800111n,
    3335194564330405738789513n,
    3788850712295073660633365n,
    4769545274046463711787127n,
    3501684564316393331161026n,
    478724465208791303993538n,
    7670970503484625339197487n,
    5409372910461916801917602n,
    3407571814614926638522996n,
    4992197225465444628134293n,
    3464917862222774498999747n,
    8264231395639331365181059n,
    7542762883940064149373594n,
    4705883992701733554215116n,
    2543224436622680115559363n,
    8364465194774622207600181n,
    3951479525812541006499090n,
    3019368700943190796858400n,
    2256343278528523810367861n,
    6089094811987317082690334n
  ]

const modExp = function (a, b, n) {
    a %= n;
    var rslt = 1n , x = a , lsb;
    while (b > 0) {
        lsb = b % 2n;
        b = b / 2n;
        if (lsb == 1n) {
            rslt = rslt * x;
            rslt = rslt % n;
        }
        x *= x ;
        x %= n;
    }
    return rslt;
};

function zkpVerify(p , g , h){
    b = BigInt(Math.floor(Math.random()*10) % 2);
    s = zkpSendS(b)

    for(i = 0 ; i < yArr.length ; i++) {
        y = yArr[i]
        if(modExp(g , s , p) === modExp((h * (y ** b)) , 1n , p)){
            return true
        }
    }
    
    return false
}

module.exports = {zkpVerify}
